)
tsl_plot(tsl)
zoo_sweden <- tsl$Sweden
zoo_spain <- tsl$Spain
zoo_germany <- tsl$Germany
class(zoo_sweden)
zoo::coredata(zoo_sweden)
class(zoo::coredata(zoo_sweden))
zoo::index(zoo_sweden)
model_sweden <- stats::lm(
formula = zoo_sweden ~ stats::time(zoo_sweden)
)
model_sweden
zoo_sweden_detrended <- stats::residuals(model_sweden)
zoo_sweden_detrended
plot(
x = zoo_sweden_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
#' Linear Detrending
#' @param x (required, zoo object) time series to detrend.
#' @return zoo object
ts_detrend <- function(x){
m <- stats::lm(formula = x ~ stats::time(x))
y <- stats::residuals(object = m)
y
}
zoo_spain_detrended <- ts_detrend(x = zoo_spain)
plot(
x = zoo_spain_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
x <- zoo::zoo(0:10)
plot(
x = x,
col = "red4",
mar = c(0.5, 1, 0, 1)
)
x_detrended <- ts_detrend(x = x)
plot(
x = x_detrended,
col = "red4",
ylim = range(x),
mar = c(0.5, 5, 0, 5)
)
zoo_spain_scaled <- scale(
x = zoo_spain,
center = TRUE,
scale = TRUE
)
zoo_spain_scaled
class(zoo_spain_scaled)
#' Linear Detrending and Normalization
#' @param x (required, zoo object) time series to detrend.
#' @return zoo object
ts_preprocessing <- function(x){
m <- stats::lm(formula = x ~ stats::time(x))
y <- stats::residuals(object = m)
y.scaled <- scale(x = y)
y.scaled
}
source("mini_dtw.R")
zoo_spain_ready <- ts_preprocessing(x = zoo_spain)
plot(
x = zoo_spain_ready,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
#' Euclidean Distance
#' @param x (required, numeric) row of a zoo object.
#' @param y (required, numeric) row of a zoo object.
#' @return numeric
d_euclidean <- function(x, y){
d <- sqrt(sum((x-y)^2))
d
}
d_euclidean(
x = zoo::coredata(zoo_germany)[1, ],
y = zoo::coredata(zoo_spain)[2, ]
)
d_euclidean(
x = zoo_germany[1, ],
y = zoo_spain[2, ]
)
d_euclidean(
x = as.numeric(zoo_germany[1, ]),
y = as.numeric(zoo_spain[2, ])
)
#' Euclidean Distance
#' @param x (required, numeric) row of a zoo object.
#' @param y (required, numeric) row of a zoo object.
#' @return numeric
d_euclidean <- function(x, y){
x <- as.numeric(x)
y <- as.numeric(y)
d <- sqrt(sum((x-y)^2))
d
}
d_euclidean(
x = zoo_germany[1, ],
y = zoo_spain[2, ]
)
m_dist <- matrix(
data = NA,
nrow = nrow(zoo_spain),
ncol = nrow(zoo_germany)
)
for(row.i in 1:nrow(zoo_spain)){
for(col.j in 1:nrow(zoo_germany)){
m_dist[row.i, col.j] <- d_euclidean(
x = zoo_spain[row.i, ],
y = zoo_germany[col.j, ]
)
}
}
m_dist[1:5, 1:5]
par(mar = c(4, 4, 1, 1))
graphics::image(
x = m_dist,
xlab = "zoo_spain",
ylab = "zoo_germany"
)
#' Distance Matrix Between Time Series
#' @param x (required, zoo object) time series.
#' @param y (required, zoo object) time series with same columns as `x`
#' @return matrix
distance_matrix <- function(x, y){
m_dist <- matrix(
data = NA,
nrow = nrow(y),
ncol = nrow(x)
)
for(row.i in 1:nrow(y)){
for(col.j in 1:nrow(x)){
m_dist[row.i, col.j] <- d_euclidean(
x = x[row.i, ],
y = y[col.j, ]
)
}
}
m_dist
}
m_dist <- distance_matrix(
x = zoo_spain,
y = zoo_sweden
)
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_dist)),
y = seq_len(nrow(m_dist)),
z = m_dist,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
m_cost <- matrix(
data = NA,
nrow = nrow(m_dist),
ncol = ncol(m_dist)
)
m_cost[1, ] <- cumsum(m_dist[1, ])
m_cost[, 1] <- cumsum(m_dist[, 1])
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_cost)),
y = seq_len(nrow(m_cost)),
z = m_cost,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
m_cost[1:2, 1:2]
m_cost[2, 2] <- min(
m_cost[1, 2],
m_cost[2, 1]
) + m_dist[2, 2]
m_cost[1:2, 1:2]
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_cost)),
y = seq_len(nrow(m_cost)),
z = m_cost,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
#iterate over rows of the cost matrix
for(row.i in 2:nrow(m_dist)){
#iterate over columns of the cost matrix
for(col.j in 2:ncol(m_dist)){
#get cost of neighbor with minimum accumulated cost
min_cost <- min(
m_cost[row.i - 1, col.j],
m_cost[row.i, col.j - 1]
)
#add it to the distance of the target cell
new_value <- min_cost + m_dist[row.i, col.j]
#fill the empty cell with the new value
m_cost[row.i, col.j] <- new_value
}
}
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_cost)),
y = seq_len(nrow(m_cost)),
z = m_cost,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
m <- nrow(m_cost)
n <- ncol(m_cost)
m_cost[(m-1):m, (n-1):n]
m_cost[m, n] <- m_cost[m, n] + m_cost[1, 1]
m_cost[(m-1):m, (n-1):n]
#' Cost Matrix from Distance Matrix
#' @param m (required, matrix) distance matrix.
#' @return matrix
cost_matrix <- function(m){
m_cost <- matrix(
data = NA,
nrow = nrow(m),
ncol = ncol(m)
)
m_cost[1, ] <- cumsum(m[1, ])
m_cost[, 1] <- cumsum(m[, 1])
for(row.i in 2:nrow(m)){
for(col.j in 2:ncol(m)){
m_cost[row.i, col.j] <- min(
m_cost[row.i - 1, col.j],
m_cost[row.i, col.j - 1]
) + m[row.i, col.j]
}
}
m_cost[row.i, col.j] <- m_cost[row.i, col.j] + m_cost[1, 1]
m_cost
}
m_cost <- cost_matrix(m = m_dist)
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_cost)),
y = seq_len(nrow(m_cost)),
z = m_cost,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
path <- data.frame(
row = ncol(m_cost),
col = nrow(m_cost)
)
path
steps <- list(
left = c(path$row, max(path$col - 1, 1)),
up = c(max(path$row - 1, 1), path$col)
)
steps
costs <- list(
left = m_cost[steps$left[1], steps$left[2]],
up = m_cost[steps$up[1], steps$up[2]]
)
costs
steps[[which.min(costs)[1]]]
#' Identify Next Step of Least-Cost Path
#' @param m cost matrix.
#' @param step one row data frame with columns "row" and "col"
#' @return one row data frame
next_step <- function(m, step){
steps <- list(
left = c(step$row, max(step$col - 1, 1)),
up = c(max(step$row - 1, 1), step$col)
)
costs <- list(
left = m[steps$left[1], steps$left[2]],
up = m[steps$up[1], steps$up[2]]
)
coords <- steps[[which.min(costs)[1]]]
#rewrite input with new values
step[,] <- c(coords[1], coords[2])
step
}
next_step(
m = m_cost,
step = path
)
repeat{
#find next step
new.step <- next_step(
m = m_cost,
step = tail(path, n = 1)
)
#join the new step with path
path <- rbind(
path, new.step,
make.row.names = FALSE
)
#stop when coordinates are 1, 1
if(all(tail(path, n = 1) == 1)){break}
}
path
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_cost)),
y = seq_len(nrow(m_cost)),
z = m_cost,
xlab = "zoo_sweden",
ylab = "zoo_spain"
)
graphics::lines(
x = path$row,
y = path$col
)
blogdown:::preview_site()
library(distantia, quietly = TRUE)
library(zoo, quietly = TRUE)
tsl <- tsl_initialize(
x = fagus_dynamics,
name_column = "name",
time_column = "time"
) |>
tsl_subset(
names = c("Spain", "Sweden")
time = c("2010-01-01", "2011-01-01")
library(distantia, quietly = TRUE)
library(zoo, quietly = TRUE)
tsl <- tsl_initialize(
x = fagus_dynamics,
name_column = "name",
time_column = "time"
) |>
tsl_subset(
names = c("Spain", "Sweden"),
time = c("2010-01-01", "2011-01-01")
) |>
tsl_colnames_set(
names = c("evi", "rain", "temp")
)
tsl_plot(tsl)
zoo_sweden <- tsl$Sweden
zoo_spain <- tsl$Spain
class(zoo_sweden)
help(tsl_plot)
library(distantia, quietly = TRUE)
library(zoo, quietly = TRUE)
tsl <- tsl_initialize(
x = fagus_dynamics,
name_column = "name",
time_column = "time"
) |>
tsl_subset(
names = c("Spain", "Sweden"),
time = c("2010-01-01", "2011-01-01")
) |>
tsl_colnames_set(
names = c("evi", "rain", "temp")
)
tsl_plot(tsl, text_cex = 1.5)
library(distantia, quietly = TRUE)
tsl <- tsl_initialize(
x = fagus_dynamics,
name_column = "name",
time_column = "time"
) |>
tsl_subset(
names = c("Spain", "Sweden")
)
tsl_plot(tsl, text_cex = 1)
tsl_plot(tsl, text_cex = 2)
help(plot)
zoo_sweden_detrended <- stats::residuals(model_sweden)
zoo_sweden_detrended
plot(
x = zoo_sweden_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5),
cex = 1.5
)
zoo_sweden_detrended <- stats::residuals(model_sweden)
zoo_sweden_detrended
plot(
x = zoo_sweden_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5),
cex = 1.5
)
zoo_sweden_detrended <- stats::residuals(model_sweden)
zoo_sweden_detrended
plot(
x = zoo_sweden_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5),
text_cex = 1.5
)
help(plot.zoo)
zoo_sweden_detrended <- stats::residuals(model_sweden)
zoo_sweden_detrended
plot(
x = zoo_sweden_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5),
cex = 5
)
#' Linear Detrending
#' @param x (required, zoo object) time series to detrend.
#' @return zoo object
ts_detrend <- function(x){
m <- stats::lm(formula = x ~ stats::time(x))
y <- stats::residuals(object = m)
y
}
ts_detrend <- function(x){
stats::residuals(
object = stats::lm(
formula = x ~ stats::time(x)
)
)
}
zoo_spain_detrended <- ts_detrend(x = zoo_spain)
plot(
x = zoo_spain_detrended,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
#' Linear Detrending and Normalization
#' @param x (required, zoo object) time series to detrend.
#' @return zoo object
ts_preprocessing <- function(x){
m <- stats::lm(formula = x ~ stats::time(x))
y <- stats::residuals(object = m) |>
scale()
y
}
source("mini_dtw.R")
zoo_spain_ready <- ts_preprocessing(x = zoo_spain)
plot(
x = zoo_spain_ready,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
zoo_spain_ready <- ts_preprocessing(x = zoo_spain)
plot(
x = zoo_spain_ready,
col = "red4",
mar = c(0.5, 5, 0, 5)
)
#' Euclidean Distance
#' @param x (required, numeric) row of a zoo object.
#' @param y (required, numeric) row of a zoo object.
#' @return numeric
d_euclidean <- function(x, y){
sqrt(sum((x - y)^2))
}
d_euclidean(
x = zoo::coredata(zoo_sweden)[1, ],
y = zoo::coredata(zoo_spain)[2, ]
)
d_euclidean(
x = zoo_sweden[1, ],
y = zoo_spain[2, ]
)
#' Euclidean Distance
#' @param x (required, numeric) row of a zoo object.
#' @param y (required, numeric) row of a zoo object.
#' @return numeric
d_euclidean <- function(x, y){
sqrt(
sum((as.numeric(x) - as.numeric(y))^2)
)
}
d_euclidean(
x = zoo_sweden[1, ],
y = zoo_spain[2, ]
)
m_dist <- matrix(
data = NA,
nrow = nrow(zoo_spain),
ncol = nrow(zoo_sweden)
)
for(row.i in 1:nrow(zoo_spain)){
for(col.j in 1:nrow(zoo_sweden)){
m_dist[row.i, col.j] <- d_euclidean(
x = zoo_spain[row.i, ],
y = zoo_sweden[col.j, ]
)
}
}
m_dist <- matrix(
data = NA,
nrow = nrow(zoo_spain),
ncol = nrow(zoo_sweden)
)
#iterate over rows
for(row in 1:nrow(zoo_spain)){
for(col in 1:nrow(zoo_sweden)){
m_dist[row, col] <- d_euclidean(
x = zoo_spain[row, ],
y = zoo_sweden[col, ]
)
}
}
m_dist[1:5, 1:5]
par(mar = c(4, 4, 1, 1))
graphics::image(
x = m_dist,
xlab = "zoo_spain",
ylab = "zoo_sweden"
)
par(mar = c(4, 4, 1, 1))
graphics::image(
x = seq_len(ncol(m_dist)),
y = seq_len(nrow(m_dist)),
z = m_dist,
xlab = "zoo_spain",
ylab = "zoo_sweden"
)
